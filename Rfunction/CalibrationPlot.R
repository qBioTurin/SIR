
library(ggplot2)

calibration.plot <- function(solverName_path,reference_path,print=T)
{
  solverName_path<-strsplit(split = "-calibration",x = solverName_path)
  solverName_path  <- solverName_path[[1]][1]
  strings<-strsplit(split = "/",x = solverName_path[[1]][1])
  
  folder<-paste(strings[[1]][1:(length(strings[[1]])-1)],collapse = "/")
  load(paste0(solverName_path,"-calibration_optim.RData"))
  load(paste0(solverName_path,"-calibration.RData"))
  
  reference <- as.data.frame(read.csv(reference_path,
                                      header = FALSE,
                                      sep = ""))
  calibration_optim_trace <-read.csv(paste0(solverName_path,"-calibration_optim-config.csv"),sep = "")
  
  
  # Then, we read all the trajectories generated saving them in a list called
  # ListTraces. List that will be rewritten as a data frame in order to use ggplot.
  # ConfigID represents the initial condition associated to each trajectory,
  # which was generated by using the function implemented in the file Functions.R .
  

  listFile<-list.files(folder,
                       pattern = ".trace")
  
  id.traces<-calibration_optim_trace$id
  
  ListTraces<-lapply(id.traces,
                     function(x){
                       trace.tmp=read.csv(paste0(solverName_path,
                         "-calibration-",
                         x,
                         ".trace"), sep = "")
                       trace.tmp=data.frame(trace.tmp,ID=calibration_optim_trace$distance[which(calibration_optim_trace$id==x)])
                       return(trace.tmp)
                     })
  
  traces <- do.call("rbind", ListTraces)
  
  plI<-ggplot( )+
    geom_line(data=traces,
              aes(x=Time,y=I,group=ID,col=ID))+
    geom_line(data=reference,
              aes(x=V1,y=V2),
              col="red",linetype="dashed")+
    theme(axis.text=element_text(size=18),
          axis.title=element_text(size=20,face="bold"),
          legend.text=element_text(size=18),
          legend.title=element_text(size=20,face="bold"),
          legend.position="right",
          legend.key.size = unit(1.3, "cm"),
          legend.key.width = unit(1.3,"cm") )+
    labs(x="Weeks", y="I",col="Distance")
  
  plS<-ggplot( )+
    geom_line(data=traces,
              aes(x=Time,y=S,group=ID,col=ID))+
    theme(axis.text=element_text(size=18),
          axis.title=element_text(size=20,face="bold"),
          legend.text=element_text(size=18),
          legend.title=element_text(size=20,face="bold"),
          legend.position="right",
          legend.key.size = unit(1.3, "cm"),
          legend.key.width = unit(1.3,"cm") )+
    labs(x="Weeks", y="S",col="Distance")
  
  plR<-ggplot( )+
    geom_line(data=traces,
              aes(x=Time,y=R,group=ID,col=ID))+
    theme(axis.text=element_text(size=18),
          axis.title=element_text(size=20,face="bold"),
          legend.text=element_text(size=18),
          legend.title=element_text(size=20,face="bold"),
          legend.position="right",
          legend.key.size = unit(1.3, "cm"),
          legend.key.width = unit(1.3,"cm") )+
    labs(x="Weeks", y="R",col="Distance")
  
  ListReturn<-list(plS=plS,plI=plI,plR=plR)
  
  if(print){
    for(j in 1:length(ListReturn))
      print(ListReturn[j])
  }

  
  return(ListReturn)
  
}
